
= Using this system to build Linux/RTAI

First build the linux kernel.  This uses the kernel.org tarball, with
packaging provided by a local git repo based on Debian's packaging of
the linux kernel.  Our local debian packaging of the linux kernel adds
the rtai patch and not much else.

Then build linux-tools.

Then build RTAI.


= Modifying/updating Linux or RTAI

The original packaging of Linux/RTAI targets Linux 3.4.87 and RTAI 4.0
*plus* the ShabbyX/memleak mods.  So not RTAI 4.0 from Paolo.


== Modifying/updating Linux

The linux/linux-$(LINUX_VERSION/debian directory is a checkout of a
git branch.  The git repo is cloned and the branch checked out by make
when the debian/ directory does not exist, and is left alone otherwise.

The git repo & branch the the debian/ directory is initialized to (if
it does not exist) are configured at the top of the top-level Makefile.

The original debian/ packaging for Linux 3.4.87 with the rtai
4.0-shabby-111-g44557fc kernel patch was created from the Debian kernel
packaging repo:

    http://anonscm.debian.org/viewvc/kernel/

To access this SVN repo via git add this to your .git/config:

-----
    [svn-remote "dists-trunk"]
        url = svn://anonscm.debian.org/svn/kernel/dists/trunk/linux/debian/
        fetch = :refs/remotes/dists-trunk
-----

The original packaging was branched from r19214, which was the last
commit of the upstream packaging to support the 3.4 kernel.

Good info on working with the Debian packaging of the Linux kernel is
available in the Debian Linux Kernel Handbook:

    http://kernel-handbook.alioth.debian.org/


=  linux-tools

The linux-tools packaging is from the upstream debian packaging.

Add this to .git/config:

-----
    [svn-remote "dists-trunk"]
    url = svn://svn.debian.org/svn/kernel/dists/trunk/linux-tools/debian/
    fetch = :refs/remotes/dists-trunk
-----

The most recent commit in linux-tools dists-trunk that applies to linux
3.4 is r19111, fcdbb9d49df93aa5801157ecd0d7b4f97754f5ab, so create a
3.4 branch from that.

Cherry-picked 784d0fc795fb7b8b9f6a6186335caa171c16225c (adds .tar.xz
support).


= Old notes to self

To build all debs:

    DEB_BUILD_OPTIONS=parallel=$(($(nproc)*2)) fakeroot debian/rules binary

To build just a particular deb:

    DEB_BUILD_OPTIONS=parallel=$(($(nproc)*2)) fakeroot make -f debian/rules.gen binary-arch_amd64_rtai   


= Open Issues

== Linux doesnt build on Precise

-----
dh_testdir
dh_prep
kernel-wedge install-files 3.4-9
        install -D -m 644 debian/linux-image-3.4-9-486/boot/vmlinuz-3.4-9-486 debian/kernel-image-3.4-9-486-di/boot/vmlinuz
        install -D -m 644 debian/linux-image-3.4-9-486/boot/System.map-3.4-9-486 debian/kernel-image-3.4-9-486-di/boot/System.map
        kernel-wedge copy-modules 3.4-9 486 3.4-9-486
tar: *: Cannot stat: No such file or directory
tar: 0: Cannot stat: No such file or directory
tar: 0x0: Cannot stat: No such file or directory
tar: 0x00: Cannot stat: No such file or directory
tar: 0x0000: Cannot stat: No such file or directory
tar: 0x000000: Cannot stat: No such file or directory
tar: 0x00000000: Cannot stat: No such file or directory
tar: 0x00000001: Cannot stat: No such file or directory
tar: 0x00000002: Cannot stat: No such file or directory
tar: 0x00000003: Cannot stat: No such file or directory
tar: 0x00000004: Cannot stat: No such file or directory
tar: 0x00000005: Cannot stat: No such file or directory
... (and lots more)
-----

== Why does pbuilder re-create the dsc, but differently?

The .orig.tar.xz is the same but the other files have different md5sums.

